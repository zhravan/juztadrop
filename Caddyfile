# Main domain - Frontend
justadrop.xyz {
    # Enable automatic HTTPS
    # Caddy will automatically obtain and renew SSL certificates from Let's Encrypt

    # Reverse proxy to Next.js web app
    reverse_proxy web:3000 {
        # Health check
        health_uri /
        health_interval 30s
        health_timeout 10s
    }

    # Enable compression
    encode gzip zstd

    # Security headers
    header {
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        # Prevent MIME sniffing
        X-Content-Type-Options "nosniff"
        # XSS Protection
        X-XSS-Protection "1; mode=block"
        # Referrer Policy
        Referrer-Policy "strict-origin-when-cross-origin"
        # Permissions Policy
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
        # Remove Server header
        -Server
    }

    # Logging
    log {
        output file /var/log/caddy/justadrop.xyz.log
        format json
    }
}

# API subdomain
api.justadrop.xyz {
    # Reverse proxy to Elysia API
    reverse_proxy api:3001 {
        # Health check
        health_uri /health
        health_interval 30s
        health_timeout 10s
    }

    # Enable compression
    encode gzip zstd

    # Security headers
    header {
        # CORS headers are handled by the API itself
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        -Server
    }

    # Logging
    log {
        output file /var/log/caddy/api.justadrop.xyz.log
        format json
    }
}

# Optional: www redirect
www.justadrop.xyz {
    redir https://justadrop.xyz{uri} permanent
}
